#include "GeomObject.hh"


//----------------------------------------------------------------------//
// Constructor                                                          //
//----------------------------------------------------------------------//
GeomObject::GeomObject(G4double xPos, G4double yPos, G4double zPos, G4double xRot, G4double yRot, G4double zRot, G4double xSize, G4double ySize, G4double zSize) {

    pos.setX(xPos);
    pos.setY(yPos);
    pos.setZ(zPos);
    sizes.setX(xSize);
    sizes.setY(ySize);
    sizes.setZ(zSize);
    rots.setX(xRot);
    rots.setY(yRot);
    rots.setZ(zRot);
    rot.rotateX(xRot);
    rot.rotateY(yRot);
    rot.rotateZ(zRot);
    invrot = rot.inverse();
    superMatrix = new G4ErrorMatrix(6, 6);
    superVector = new G4ErrorMatrix(6, 1);
    for(G4int a = 0; a < 3; a++) {
        for(G4int b = 0; b < 3; b++) {
            (*superMatrix)[a][b] = invrot[a][b];
            (*superMatrix)[a+3][b+3] = invrot[a][b];
        }
        (*superVector)[a][0] = pos[a];
    }
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get the rotation of this detector                                    //
//----------------------------------------------------------------------//
G4RotationMatrix *GeomObject::getRot() {
    return & rot;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get the position of this detector                                    //
//----------------------------------------------------------------------//
G4ThreeVector GeomObject::getPos() {
    return pos;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get the position of this detector                                    //
//----------------------------------------------------------------------//
G4ThreeVector GeomObject::getSizes() {
    return sizes;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Transform to global coordinates                                      //
//----------------------------------------------------------------------//
G4ThreeVector GeomObject::toGlobal(G4ThreeVector a) {
    return invrot * a + pos;
}
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Transform to global coordinates                                      //
//----------------------------------------------------------------------//
G4ErrorMatrix GeomObject::toGlobalStateVector(G4ErrorMatrix a) {
    return (*superMatrix) * a + (*superVector);
}
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Transform to global coordinates                                      //
//----------------------------------------------------------------------//
G4ErrorMatrix GeomObject::toGlobalStateCov(G4ErrorMatrix a) {
    return (*superMatrix) * a * superMatrix->T();
}
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Transform to local coordinates                                       //
//----------------------------------------------------------------------//
G4ThreeVector GeomObject::toLocal(G4ThreeVector a) {
    return  rot * (a - pos);
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Volume                                                               //
//----------------------------------------------------------------------//
void GeomObject::setPhysicalVolume(G4VPhysicalVolume *a) {
    physicalVolume = a;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get Volume                                                           //
//----------------------------------------------------------------------//
G4VSolid * GeomObject::getSolidVolume() {
    return solidVolume;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get Volume                                                           //
//----------------------------------------------------------------------//
G4LogicalVolume * GeomObject::getLogicalVolume() {
    return logicalVolume;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Get Volume                                                           //
//----------------------------------------------------------------------//
G4VPhysicalVolume * GeomObject::getPhysicalVolume() {
    return physicalVolume;
}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//


//----------------------------------------------------------------------//
// Print                                                                //
//----------------------------------------------------------------------//
void GeomObject::Print() {

    G4cout << "\033[1;34m" << "GeomObject" << "\033[0m" << G4endl;
    G4cout << "\033[1;34m" << "Location x: " << pos.x() << ", y: " << pos.y() << ", z: " << pos.z() << G4endl;
    G4cout << "\033[1;34m" << "Rotation x: " << rots.x() << ", y: " << rots.y() << ", z: " << rots.z() << G4endl;
    G4cout << "\033[1;34m" << "Sizes x: " << sizes.x() << ", y: " << sizes.y() << ", z: " << sizes.z() << G4endl;
    G4cout << "\033[0m" << G4endl;

}
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
